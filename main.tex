\documentclass[a4paper, 12pt, openany]{book}

% ===================== PACKAGES =====================
% Basic text and encoding
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[lmargin=1.5in, rmargin=1in, tmargin=1in, bmargin=1in]{geometry} %sets the margins for the pages - Nina Salvesen's NTNU template settings
\setcounter{tocdepth}{2} %table of contents number depth for subsections (2 = x.x.x)
\setcounter{secnumdepth}{4} %numbering depth for headers for subsections in the text(4 = x.x.x.x)

% Page styling and headers
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage[Bjarne]{fncychap}

% Tables and figures
\usepackage{booktabs}
\usepackage{caption}
\usepackage{graphicx}
\usepackage{float}
\usepackage{subfig}
\usepackage{longtable}

% ================ Mathematics and symbols =========
\usepackage{amsmath, amssymb, mathtools, bm, siunitx}

% TikZ and plotting
\usepackage{tikz}
\usetikzlibrary{positioning, arrows.meta, shapes, fit, calc}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}

% ===================== IEEE STYLE BIBLIOGRAPHY =====================
% CHANGED FROM: \usepackage[backend=biber, style=numeric, sorting=none]{biblatex}
\usepackage[
    style=ieee,              % IEEE citation style
    backend=biber,           % Use biber backend
    sorting=none,            % Citations in order of appearance
    maxbibnames=99,          % Show all authors
    doi=true,                % Show DOIs
    isbn=false,              % Don't show ISBNs
    url=true,                % Show URLs
    giveninits=true,         % Use initials for first names
    abbreviate=true          % Abbreviate journal names
]{biblatex}
\addbibresource{bibliography.bib}

% Hyperlinks and cross-references
\usepackage{hyperref}
\usepackage{cleveref}

% URL handling
\usepackage{url}

% Define NTNU colors
\definecolor{ntnu-purple}{HTML}{4F2B80} % Purple
\definecolor{ntnu-gray}{HTML}{A7A8AA} % Gray
\definecolor{ntnu-yellow}{HTML}{F2A900} % Yellow

% Text positioning
\usepackage[absolute, overlay]{textpos}

% ===================== PACKAGE CONFIGURATIONS =====================
% Graphics settings
\graphicspath{{Figures/}}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}

% Hyperref configuration
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    citecolor=blue,
    urlcolor=blue,
    pdfauthor={Zeshan Mubshir},
    pdftitle={Autonomous Monitoring of Floating Solar PVs Anomalies using Deep Learning Methods},
    pdfkeywords={Solar PV, Anomaly Detection, Deep Learning},
    pdfsubject={Master's Thesis}
}

% ===================== CUSTOM COMMANDS =====================
\newcommand{\myemptypage}{ \null
\thispagestyle{empty}
\addtocounter{page}{-1}
\newpage
}

% ===================== DOCUMENT START =====================
\begin{document}
    

    % ===================== TITLE PAGE =====================
    \begin{titlepage}
        \newgeometry{left=2.5in, right=2in}
        \setlength{\TPHorizModule}{1cm}
        \setlength{\TPVertModule}{1cm}
        \textblockorigin{0cm}{0cm}
        \begin{tikzpicture}[remember picture, overlay]
            % Purple rectangle starts at Zeshan Mubshir text level
            \fill[ntnu-purple]
                ([xshift=0cm, yshift=-3cm]current page.north west) rectangle ++(5cm, -10.0cm);
            
            % White area for university text
            \fill[white]
                ([xshift=4cm, yshift=-3cm]current page.north west) rectangle ++(3cm, -26.7cm);

            % "Master's thesis" text in white on purple background
            \node[
                rotate=90,
                anchor=center,
                font=\sffamily\bfseries\Large,
                color=white
            ]
                at
                ([xshift=3cm, yshift=-10.35cm]current page.north west)
                {Master's thesis};

            % NTNU university information rotated on white background
            \node[rotate=90, anchor=center, font=\sffamily\small, color=black]
                at
                ([xshift=3.0cm, yshift=-16.35cm]current page.north west)
                {\parbox{12cm}{\centering \textbf{NTNU}\\Norwegian University of Science and Technology\\ Faculty of Information Technology and Electrical Engineering\\ Department of ICT and Natural Sciences}};
        \end{tikzpicture}

        % Main title block - Nina's layout style but with your content
        \vspace*{1.5cm}

        \noindent  \textcolor{gray}{\large Zeshan Mubshir} \\
        \vspace{1cm}

        \noindent \textbf{\Large Autonomous Monitoring and Classification of Solar PVs Anomalies using Deep Learning Methods} \\
        \vspace{0.5cm}

        \noindent {\large Master's thesis in Simulation and Visualization} \\

        \vspace{7cm}
        \noindent Supervisor: Saleh Abdel-Afou Alaliyat \\
        Co-supervisor: Mohammadreza Aghaei \\
        July 2025 \\

        \begin{figure}[h]
            \includegraphics[width=0.5\textwidth]{Figures/NTNU Main Logo.png}
        \end{figure}
        \restoregeometry
    \end{titlepage}

    \myemptypage

    % ===================== FRONT MATTER =====================
    % Abstract (English Abstract)
    \chapter*{Abstract}
    \pagenumbering{roman} %introductory pages should be roman
    \setcounter{page}{1}
    \addcontentsline{toc}{chapter}{\protect\numberline{}Abstract}
    \input{Chapters/00Abstract}

    % Sammendrag (Norwegian Abstract)
    \chapter*{Sammendrag}
    \addcontentsline{toc}{chapter}{\protect\numberline{}Sammendrag}
    \input{Chapters/01Sammendrag}

    % Preface (Introduction to the thesis)
    \chapter*{Preface}
    \addcontentsline{toc}{chapter}{\protect\numberline{}Preface}
    \input{Chapters/03Preface}

    % Table of Contents
    \tableofcontents
    \addcontentsline{toc}{chapter}{\protect\numberline{}Contents}

    % List of Figures
    \addcontentsline{toc}{chapter}{\protect\numberline{}\listfigurename}
    \listoffigures
    \addcontentsline{toc}{chapter}{\protect\numberline{}\listtablename}
    \listoftables

    % Abbreviations
    \chapter*{Abbreviations}
    \addcontentsline{toc}{chapter}{\protect\numberline{}Abbreviations}
    \input{Chapters/02Abbreviations}
    \newpage

    \myemptypage % Empty page after abbreviations

    % ===================== MAIN MATTER =====================
    % Customize the layout of the main content of your thesis
    \pagestyle{fancy} %set customized page style for header
    \fancyhf{} %clear header and footer fields
    \renewcommand{\headrulewidth}{0pt} %set to no rule
    \fancyhead[LE, RO]{\thepage} %set the page number at left for even, right for odd pages
    \fancyhead[RE, LO]{\leftmark} %set the chapter name at right for even, left for odd pages
    \setlength{\headheight}{14.49998pt} %set the header height

    \mainmatter
    \pagenumbering{arabic}

    % Chapters
    \chapter{Introduction}
    \input{Chapters/Ch1Introduction}
    \cleardoublepage

    \chapter{Literature Review}
    \input{Chapters/Ch2Literature Review}
    \cleardoublepage

    \chapter{Theoretical Background}
    \input{Chapters/Ch3Theoratical Background}
    \cleardoublepage

    \chapter{Methodology}
    \input{Chapters/Ch4Methodology}
    \cleardoublepage

    \chapter{Results}
    \input{Chapters/Ch5Results}
    \cleardoublepage

    \chapter{Discussion}
    \input{Chapters/Ch6Discussion}  % Removed .tex extension
    \cleardoublepage

    \chapter{Conclusions}
    \input{Chapters/Ch7Conclusion}
    \cleardoublepage

    % ===================== BACK MATTER =====================
    \backmatter

    % Bibliography
    \addcontentsline{toc}{chapter}{\protect\numberline{}References}
    \printbibliography[title={References}]
    \cleardoublepage

    % Appendices
    \chapter*{\LARGE \textbf{Appendices}}
    \fancyhf{} %clear the header, it should be empty for the appendices
    \renewcommand{\headrulewidth}{0pt} %no rule
    \fancyfoot[C]{\thepage} %set the page numbers in the center of the footer instead
    \addcontentsline{toc}{chapter}{\protect\numberline{}Appendices}
    \appendix
        \input{Chapters/Ch8Appendix}

    % ===================== BACK COVER =====================
    \cleardoublepage
    \thispagestyle{empty}
    \newgeometry{top=0cm,bottom=0cm,left=0cm,right=0cm}

    % Clean back cover design matching the provided reference image
    \begin{tikzpicture}[remember picture, overlay]
        % White circle in upper portion (not center)
        \draw[fill=white, draw=gray!30, line width=1pt]
            ($(current page.center) + (0,2cm)$) circle (3.5cm);

        % Purple rectangle at top - bottom aligns with circle center
        \fill[ntnu-purple]
            (current page.north west) rectangle 
            ($(current page.center) + (21cm,2cm)$);

        % Vertical line from bottom of circle going down
        \draw[gray!40, line width=0.8pt]
            ($(current page.center) + (0,-1.5cm)$) -- ++(0,-4cm);

        % Horizontal line extending to the right edge of the page
        \draw[gray!40, line width=0.8pt]
            ($(current page.center) + (0,-5.5cm)$) -- ($(current page.east) + (-1cm,-5.5cm)$);

        % NTNU logo at bottom center
        \node[anchor=center] at ($(current page.south) + (0,4cm)$)
            {\includegraphics[width=0.35\textwidth]{Figures/NTNU Main Logo.png}};
    \end{tikzpicture}

    \restoregeometry
 
\end{document}